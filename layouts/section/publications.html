{{ define "extra_head" }}
{{ $style := resources.Get "sass/publications.scss" | resources.ToCSS | resources.Fingerprint }}
<link rel="stylesheet" href="{{ $style.Permalink }}" integrity="{{ $style.Data.Integrity }}">
{{ end }}



{{ define "main" }}
{{ $search_icon := resources.Get "/svgs/search_icon.svg" }}

<div class="main-container">

    <div class="filter-container">
        <h1>Filter</h1>
        <div class="filter-grid">
            <button type="button" id="Latest">Latest</button>
            <button type="button" id="Oldest">Oldest</button>
            <button type="button" id="A-Z">A-Z</button>
            <button type="button" id="Z-A">Z-A</button>
        </div>
        <div class="search-box">
            <button class="btn-search">
                <img height="50%" src="{{ $search_icon.RelPermalink }}">
            </button>
            <input type="text" class="input-search" id="searchInput" placeholder="Type to search...">
        </div>
    </div>

    <div class="publications-container">
    {{ range .Pages }}
            <div class="publication {{ replace .Params.date " " "" }}" id=" {{ replace .Params.title " " "" }} {{ replace .Params.authors " " "" }}" href="{{ .RelPermalink }}">
                <div class="publication-header"></div>
                <div class="title">{{ .Params.title }}</div>
                <div class="info subset-authors">
                    {{ $max_number_authors := 7 }}
                    {{ $concatenated_authors := replace .Params.authors " " "" }}
                    {{ $number_of_authors := replace $concatenated_authors "," " " | countwords }}
                    {{ $subsetted_authors := findRESubmatch `[^,]*` .Params.authors $max_number_authors }}

                    {{ if (gt $number_of_authors $max_number_authors) }}
                        {{ range $index, $author := $subsetted_authors }}
                            {{ index $author 0 }}{{ if (lt $index (sub $max_number_authors 1)) }},{{ end }}
                        {{ end }}
                        <i>+ {{ sub $number_of_authors $max_number_authors }} more</i>
                    {{ else }}
                        {{ .Params.authors }}
                    {{ end }}
                </div>
                <div class="info all-authors">
                    {{ $all_authors := findRESubmatch `[^,]*` .Params.authors }}
                    {{ range $index, $author := $all_authors }}
                        {{ index $author 0 }}{{ if (lt $index (sub $number_of_authors 1)) }},{{ end }}
                    {{ end }}
                </div>
                <div class="info">{{ .Params.journal }}</div>
                <div class="info">{{ .Params.date }}</div>
                <div class="extra-information-container">
                    {{ if or .Params.link .Params.geo_numbers .Params.abstract }}
                        <h2>Paper information</h2>
                    {{ end }}
                    {{ if .Params.link }}
                        <div class="geo-container">
                            <div class="geo-item">
                                <a href="{{ .Params.link }}" target="_blank">Publication Link</a>
                            </div>
                        </div>
                    {{ end }}
                        {{ $number_of_geos :=  strings.CountWords .Params.geo_numbers }}
                        {{ if gt  $number_of_geos 0 }}
                            <h3>Geo Acession Numbers</h3>
                            {{ $geo_numbers := findRESubmatch `[^,]*` .Params.geo_numbers }}
                            <div class="geo-container">
                                {{ range $geo_numbers }}
                                    <div class="geo-item">
                                        {{ $geo_item := index . 0}}
                                        <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc={{ $geo_item }}" target="_blank">{{ $geo_item }}</a>
                                    </div>
                                {{ end }}
                            </div>
                        {{ end }}
                        {{ if .Params.abstract }}
                        <h3>Abstract</h3>
                        <p>{{ .Params.abstract }}</p>
                        {{ end }}
                    </div>
                </div>

            </div>
    {{ end }}

    </div>


</div>
{{ end }}


{{ define "scripts" }}
{{ with resources.Get "js/publication_filtering.js" }}
<script type="application/javascript" src="{{ .Permalink }}"></script>
{{ end }}

{{ with resources.Get "js/expand_publication.js" }}
<script type="application/javascript" src="{{ .Permalink }}"></script>
{{ end }}
{{ end }}
